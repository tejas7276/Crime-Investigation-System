<app-navbar></app-navbar>

<div class="crime-dashboard-container">
  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <div class="title-group">
        <i class="bi bi-shield-lock premium-icon"></i>
        <h1 class="premium-title">Crime Intelligence Dashboard</h1>
      </div>
      <div class="stats-badge">
        <span class="badge premium-badge">
          {{ crimes.length }} {{ crimes.length === 1 ? "Case" : "Cases" }}
        </span>
      </div>
    </div>

    <!-- Filter Bar -->
    <div class="premium-filter-bar">
      <div class="search-container">
        <i class="bi bi-search search-icon"></i>
        <input
          type="text"
          class="premium-search"
          [(ngModel)]="searchText"
          placeholder="Search cases..."
          (input)="clearError()"
        />
      </div>
      <div class="filter-controls">
        <select class="premium-select" [(ngModel)]="selectedStatus">
          <option value="">All Status</option>
          <option value="PENDING">Pending</option>
          <option value="RESOLVED">Resolved</option>
          <option value="URGENT">Urgent</option>
        </select>
        <button class="premium-filter-btn" (click)="clearFilters()">
          <i class="bi bi-funnel"></i> Clear Filters
        </button>
      </div>
    </div>
  </div>

  <!-- Dashboard Content -->
  <div class="dashboard-content">
    <!-- Loading State -->
    <div *ngIf="loading" class="premium-loading">
      <div class="loading-animation">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
      <h3 class="loading-text">Analyzing Crime Data</h3>
      <p class="loading-subtext">Securely loading your records...</p>
    </div>

    <!-- Empty State -->
    <div
      *ngIf="!loading && filteredCrimes().length === 0"
      class="premium-empty-state"
    >
      <div class="empty-state-content">
        <i class="bi bi-database-x empty-icon"></i>
        <h3>No Cases Found</h3>
        <p>Adjust your search criteria or report a new case</p>
        <button
          class="premium-btn primary"
          [routerLink]="['/file-crime', userId]"
        >
          <i class="bi bi-plus-circle"></i> New Case
        </button>
      </div>
    </div>

    <!-- Data Table -->
    <div
      *ngIf="!loading && filteredCrimes().length > 0"
      class="premium-table-container"
    >
      <div class="table-description">
        <p>
          Below is the detailed list of all reported criminal cases with their
          current investigation status and assigned law enforcement officers.
        </p>
      </div>
      <div class="table-responsive">
        <table
          class="table premium-table"
          style="width: 100%; table-layout: fixed"
        >
          <thead>
            <tr class="table-header">
              <th
                (click)="sortBy('id')"
                class="sortable-header"
                style="width: 80px"
              >
                <span>Case ID</span>
                <i class="bi bi-arrow-down-up sort-icon"></i>
              </th>
              <th
                (click)="sortBy('type')"
                class="sortable-header"
                style="width: 150px"
              >
                <span>Crime Type</span>
                <i class="bi bi-arrow-down-up sort-icon"></i>
              </th>
              <th
                (click)="sortBy('location')"
                class="sortable-header"
                style="width: 200px"
              >
                <span>Location</span>
                <i class="bi bi-arrow-down-up sort-icon"></i>
              </th>
              <th
                (click)="sortBy('date')"
                class="sortable-header"
                style="width: 180px"
              >
                <span>Date/Time</span>
                <i class="bi bi-arrow-down-up sort-icon"></i>
              </th>
              <th style="width: 120px">Status</th>
              <th style="width: 220px">Assigned Agent</th>
              <th *ngIf="isAdmin()" style="width: 200px">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let crime of filteredCrimes()" class="table-row">
              <td class="case-id" style="width: 80px">{{ crime.id }}</td>
              <td class="crime-type" style="width: 150px">{{ crime.type }}</td>
              <td class="location" style="width: 200px">
                <i class="bi bi-geo-alt-fill"></i>
                {{ crime.location }}
              </td>
              <td class="date-time" style="width: 180px">
                {{ formatDateTime(crime.date, crime.time) || "N/A" }}
              </td>
              <td class="status-cell" style="width: 120px">
                <span
                  class="status-badge"
                  [ngClass]="{
                    'status-pending': crime.status === 'PENDING',
                    'status-resolved': crime.status === 'RESOLVED',
                    'status-urgent': crime.status === 'URGENT'
                  }"
                >
                  {{ crime.status }}
                </span>
              </td>
              <td class="agent-cell" style="width: 220px">
                <div
                  *ngIf="
                    crime.assignedOfficer || crime.officername;
                    else unassigned
                  "
                  class="agent-badge"
                >
                  <div class="agent-avatar">
                    {{
                      crime.assignedOfficer?.name || crime.officername
                        | slice : 0 : 1
                    }}
                  </div>
                  <div class="agent-info">
                    <span class="agent-name">
                      {{ crime.assignedOfficer?.name || crime.officername }}
                    </span>
                    <span
                      *ngIf="crime.assignedOfficer?.id || crime.officerId"
                      class="badge-id"
                    >
                      ID: {{ crime.assignedOfficer?.id || crime.officerId }}
                    </span>
                  </div>
                </div>
                <ng-template #unassigned>
                  <div class="unassigned-badge">
                    <i class="bi bi-person-x"></i>
                    <span>Unassigned</span>
                  </div>
                </ng-template>
              </td>
              <td *ngIf="isAdmin()" class="action-cell" style="width: 200px">
                <div class="action-buttons">
                  <select
                    class="premium-select-sm"
                    [(ngModel)]="crime.assignedOfficerId"
                  >
                    <option value="">Assign Agent</option>
                    <option
                      *ngFor="let officer of officers"
                      [value]="officer.id"
                    >
                      {{ officer.name }} ({{ officer.badgeNumber }})
                    </option>
                  </select>
                  <button
                    class="premium-btn-sm primary"
                    (click)="assignOfficer(crime)"
                    [disabled]="!crime.assignedOfficerId"
                  >
                    <i class="bi bi-send-check"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage" class="premium-error-alert">
    <div class="alert-content">
      <i class="bi bi-exclamation-octagon-fill"></i>
      <div class="alert-message">
        <h4>Data Loading Error</h4>
        <p>{{ errorMessage }}</p>
      </div>
      <button class="close-btn" (click)="clearError()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
  </div>
</div>
